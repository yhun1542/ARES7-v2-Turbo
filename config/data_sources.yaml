# =============================================================================
# DATA SOURCES CONFIGURATION
# =============================================================================
# 모든 API 키는 환경변수에서 로드
# 각 데이터 소스는 알파/리스크에 실제 사용되는 피처를 생성
# =============================================================================

# -----------------------------------------------------------------------------
# Polygon.io (Primary Price Data)
# -----------------------------------------------------------------------------
polygon:
  enabled: true
  api_key_env: "POLYGON_API_KEY"
  
  endpoints:
    rest_base: "https://api.polygon.io"
    ws_base: "wss://socket.polygon.io"
  
  rate_limits:
    requests_per_minute: 5         # Free tier: 5/min
    requests_per_minute_paid: 100  # Paid tier
  
  # Features Generated
  features:
    - name: "daily_ohlcv"
      description: "Daily OHLCV for price momentum"
      use_in: ["qm_overlay", "regime_filter"]
    - name: "intraday_bars"
      description: "Intraday bars for volatility"
      use_in: ["turbo_aarm"]
  
  # S3 Flatfiles (for bulk historical)
  s3_flatfiles:
    enabled: false
    bucket_env: "POLYGON_S3_BUCKET"
    access_key_env: "AWS_ACCESS_KEY_ID"
    secret_key_env: "AWS_SECRET_ACCESS_KEY"

# -----------------------------------------------------------------------------
# SHARADAR / SF1 (Fundamental Data)
# -----------------------------------------------------------------------------
sf1:
  enabled: true
  api_key_env: "NASDAQ_DATA_LINK_API_KEY"  # Same as Quandl
  
  endpoint: "https://data.nasdaq.com/api/v3"
  dataset: "SHARADAR/SF1"
  
  # Point-in-Time Settings
  pit_settings:
    delay_days: 90                 # 90-day lag for PIT compliance
    dimension: "ARQ"               # Annual Restated Quarterly
  
  # Features Generated (Quality Factors)
  features:
    - name: "roe"
      formula: "netinc / equity"
      use_in: ["qm_overlay"]
    - name: "roic"
      formula: "ebit / (debt + equity)"
      use_in: ["qm_overlay"]
    - name: "grossmargin"
      formula: "grossmargin"
      use_in: ["qm_overlay"]
    - name: "currentratio"
      formula: "currentratio"
      use_in: ["qm_overlay"]
    - name: "de_ratio"
      formula: "debt / equity"
      use_in: ["qm_overlay"]
      invert: true                 # Lower is better

# -----------------------------------------------------------------------------
# FRED (Macro Indicators)
# -----------------------------------------------------------------------------
fred:
  enabled: true
  api_key_env: "FRED_API_KEY"
  
  endpoint: "https://api.stlouisfed.org/fred"
  
  # Series to Fetch
  series:
    - id: "VIXCLS"
      name: "vix"
      description: "CBOE Volatility Index"
      use_in: ["regime_filter", "turbo_aarm"]
    
    - id: "T10Y2Y"
      name: "term_spread"
      description: "10Y-2Y Treasury Spread"
      use_in: ["regime_filter"]
    
    - id: "BAMLH0A0HYM2"
      name: "credit_spread"
      description: "High Yield Credit Spread"
      use_in: ["regime_filter", "risk_scaling"]
    
    - id: "UMCSENT"
      name: "consumer_sentiment"
      description: "U of Michigan Consumer Sentiment"
      use_in: ["regime_filter"]
    
    - id: "INDPRO"
      name: "industrial_production"
      description: "Industrial Production Index"
      use_in: ["regime_filter"]
    
    - id: "UNRATE"
      name: "unemployment_rate"
      description: "Unemployment Rate"
      use_in: ["regime_filter"]
    
    - id: "DFF"
      name: "fed_funds_rate"
      description: "Effective Federal Funds Rate"
      use_in: ["regime_filter"]

# -----------------------------------------------------------------------------
# SEC API (Filings)
# -----------------------------------------------------------------------------
sec_api:
  enabled: true
  api_key_env: "SEC_API_KEY"
  
  endpoint: "https://api.sec-api.io"
  
  # Filing Types to Monitor
  filing_types:
    - "8-K"                        # Material events
    - "10-K"                       # Annual reports
    - "10-Q"                       # Quarterly reports
    - "13F"                        # Institutional holdings
  
  # Features Generated
  features:
    - name: "filing_count_30d"
      description: "Number of filings in last 30 days"
      use_in: ["event_risk"]
    - name: "has_8k_recent"
      description: "Material event flag"
      use_in: ["event_risk", "risk_scaling"]

# -----------------------------------------------------------------------------
# Tavily (AI Search & News)
# -----------------------------------------------------------------------------
tavily:
  enabled: true
  api_key_env: "TAVILY_API_KEY"
  
  endpoint: "https://api.tavily.com"
  
  # Search Settings
  search:
    search_depth: "advanced"       # basic, advanced
    max_results: 10
    include_domains: []
    exclude_domains: ["reddit.com", "twitter.com"]
  
  # Features Generated (MUST be used in alpha/risk)
  features:
    - name: "news_count_24h"
      description: "News article count in last 24h"
      use_in: ["event_risk", "volatility_forecast"]
    
    - name: "news_sentiment"
      description: "Aggregated sentiment score (-1 to 1)"
      use_in: ["qm_overlay", "regime_filter"]
    
    - name: "event_risk_flag"
      description: "Binary flag for high-risk events"
      use_in: ["risk_scaling", "cb_trigger"]
      triggers:
        - "bankruptcy"
        - "SEC investigation"
        - "fraud"
        - "CEO resignation"
        - "earnings miss"

# -----------------------------------------------------------------------------
# News API / GNews (Alternative News)
# -----------------------------------------------------------------------------
news_api:
  enabled: true
  api_key_env: "NEWS_API_KEY"
  
  providers:
    - name: "newsapi"
      endpoint: "https://newsapi.org/v2"
      api_key_env: "NEWS_API_KEY"
    
    - name: "gnews"
      endpoint: "https://gnews.io/api/v4"
      api_key_env: "GNEWS_API_KEY"
  
  # Features Generated
  features:
    - name: "headline_sentiment"
      use_in: ["qm_overlay"]
    - name: "news_volume_zscore"
      description: "Abnormal news volume"
      use_in: ["event_risk"]

# -----------------------------------------------------------------------------
# Alpha Vantage (Supplementary Data)
# -----------------------------------------------------------------------------
alpha_vantage:
  enabled: false                   # Disabled by default (rate limited)
  api_key_env: "ALPHA_VANTAGE_API_KEY"
  
  endpoint: "https://www.alphavantage.co/query"
  
  rate_limits:
    requests_per_minute: 5
    requests_per_day: 500
  
  # Use for fallback only
  use_as_fallback: true

# -----------------------------------------------------------------------------
# Alternative Data (Satellite/Climate)
# -----------------------------------------------------------------------------
alternative:
  # NASA Earthdata
  nasa:
    enabled: false
    api_key_env: "NASA_API_KEY"
    use_in: ["agriculture_sector", "energy_sector"]
  
  # NOAA Climate
  noaa:
    enabled: false
    api_key_env: "NOAA_API_KEY"
    use_in: ["utilities_sector", "insurance_sector"]

# -----------------------------------------------------------------------------
# Cache Settings
# -----------------------------------------------------------------------------
cache:
  enabled: true
  backend: "sqlite"                # sqlite, redis
  path: "./data/cache.db"
  ttl_seconds:
    prices: 86400                  # 1 day
    fundamentals: 604800           # 7 days
    macro: 3600                    # 1 hour
    news: 1800                     # 30 minutes

# -----------------------------------------------------------------------------
# Rate Limiting
# -----------------------------------------------------------------------------
rate_limiting:
  enabled: true
  strategy: "token_bucket"
  global_max_concurrent: 10
